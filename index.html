<script>
  const API = "https://backend-1-kkqs.onrender.com";
  let isLogin = true;

  function toggleForm() {
    isLogin = !isLogin;
    document.getElementById("loginForm").classList.toggle("hidden");
    document.getElementById("registerForm").classList.toggle("hidden");
    document.getElementById("title").innerText = isLogin ? "Login" : "Register";
    document.getElementById("switchText").innerText =
      isLogin ? "Don't have an account? Register" : "Already have an account? Login";
    document.getElementById("msg").innerText = "";
  }

  async function login() {
    const email = document.getElementById("loginId").value;
    const password = document.getElementById("loginPassword").value;
    const msg = document.getElementById("msg");

    msg.textContent = "Logging in...";

    try {
      const res = await fetch(`${API}/auth/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });

      const data = await res.json();

      if (res.ok) {
        msg.textContent = "Login successful!";
        msg.className = "message success";
        console.log("Token:", data);
      } else {
        msg.textContent = data.message || "Login failed";
      }
    } catch (err) {
      msg.textContent = "Network error";
    }
  }

  async function register() {
    const email = document.getElementById("regEmail").value;
    const password = document.getElementById("regPassword").value;
    const confirmPassword = document.getElementById("regConfirmPassword").value;
    const msg = document.getElementById("msg");

    if (password !== confirmPassword) {
      msg.textContent = "Passwords do not match";
      return;
    }

    msg.textContent = "Registering...";

    try {
      const res = await fetch(`${API}/auth/register`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });

      const data = await res.json();

      if (res.ok) {
        msg.textContent = "Registration successful! Please login.";
        msg.className = "message success";
        toggleForm();
      } else {
        msg.textContent = data.message || "Registration failed";
      }
    } catch (err) {
      msg.textContent = "Network error";
    }
  }
</script>
